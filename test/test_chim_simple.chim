// Chim编译器基本功能测试

fn test_basic_types() {
    let x: int = 42;
    let y: float = 3.14;
    let flag: bool = true;
    let msg: string = "Hello, Chim!";

    println(x);
    println(y);
    println(flag);
    println(msg);
}

fn test_generic_types() {
    let numbers: List[int] = [1, 2, 3, 4, 5];
    let names: List[string] = ["Alice", "Bob", "Charlie"];

    println(numbers);
    println(names);
}

fn add(a: int, b: int) -> int {
    return a + b;
}

fn multiply(x: float, y: float) -> float {
    return x * y;
}

fn test_compound_assignment() {
    var total: int = 0;
    total += 10;
    total += 20;
    total -= 5;
    total *= 2;
    total /= 4;

    var ratio: float = 1.0;
    ratio *= 0.5;
    ratio += 0.25;

    println(total);
    println(ratio);
}

fn test_range_expressions() {
    var sum: int = 0;
    for i in 1..=100 {
        sum += i;
    }

    println(sum);
}

fn test_lambda_expressions() {
    let double = (x: int) -> int {
        return x * 2;
    };

    let add_numbers = (a: int, b: int) -> int {
        return a + b;
    };

    let result = double(5);
    let sum = add_numbers(10, 20);

    println(result);
    println(sum);
}

struct Person {
    name: string,
    age: int,
}

enum Status {
    Active,
    Inactive,
    Pending(string),
}

fn test_struct_enum() {
    let alice: Person = Person { name: "Alice", age: 30 };
    let bob: Person = Person { name: "Bob", age: 25 };

    println(alice);
    println(bob);

    let active: Status = Status::Active;

    match active {
        Status::Active => println("User is active"),
        Status::Inactive => println("User is inactive"),
        Status::Pending(msg) => println("Pending: " + msg),
    }
}

fn test_loop_optimization() {
    var sum1: int = 0;
    for i in 0..=99 {
        sum1 += i;
    }

    var sum2: int = 0;
    for i in 0..=9 {
        for j in 0..=9 {
            sum2 += i * j;
        }
    }

    var invariant_sum: int = 0;
    let constant: int = 100;
    for k in 0..=99 {
        invariant_sum += constant;
    }

    println(sum1);
    println(sum2);
    println(invariant_sum);
}

fn test_conditional_match() {
    let value: int = 42;

    let message = if value > 40 {
        "Value is greater than 40"
    } else {
        "Value is 40 or less"
    };
    println(message);

    let status_code: int = 200;
    let status_message = match status_code {
        200 => "OK",
        404 => "Not Found",
        500 => "Internal Server Error",
        _ => "Unknown Status",
    };
    println(status_message);
}

fn main() {
    println("=== Chim编译器功能测试 ===");

    println("\n--- 测试1: 基本类型 ---");
    test_basic_types();

    println("\n--- 测试2: 泛型类型 ---");
    test_generic_types();

    println("\n--- 测试3: 函数和类型注解 ---");
    let a = add(10, 20);
    let b = multiply(3.0, 4.0);
    println(a);
    println(b);

    println("\n--- 测试4: 复合赋值 ---");
    test_compound_assignment();

    println("\n--- 测试5: 范围表达式 ---");
    test_range_expressions();

    println("\n--- 测试6: Lambda表达式 ---");
    test_lambda_expressions();

    println("\n--- 测试7: 结构体和枚举 ---");
    test_struct_enum();

    println("\n--- 测试8: 循环优化 ---");
    test_loop_optimization();

    println("\n--- 测试9: 条件匹配 ---");
    test_conditional_match();

    println("\n=== 所有测试完成 ===");
}
