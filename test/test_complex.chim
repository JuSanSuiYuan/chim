// 复杂测试文件

// 函数定义
fn add(a: int, b: int) -> int = a + b

fn subtract(a: int, b: int) -> int = a - b

fn multiply(a: int, b: int) -> int = a * b

fn divide(a: int, b: int) -> float {
    if b == 0: return 0.0
    (a as float) / (b as float)
}

// 结构体定义
struct Person {
    name: string
    age: int
    active: bool
}

// 枚举定义
enum Status {
    Loading
    Success(data: string)
    Error(message: string)
    Idle
}

// 主程序
print("=== Chim语言复杂特性测试 ===")

// 函数调用测试
let a = 10
let b = 5
println("a = " + a.to_string())
println("b = " + b.to_string())
println("a + b = " + add(a, b).to_string())
println("a - b = " + subtract(a, b).to_string())
println("a * b = " + multiply(a, b).to_string())
println("a / b = " + divide(a, b).to_string())

// 条件语句测试
let score = 85
if score >= 90: println("优秀")
elif score >= 80: println("良好")
elif score >= 70: println("中等")
elif score >= 60: println("及格")
else: println("不及格")

// 循环语句测试
println("\n=== 循环测试 ===")

// while循环
let mut count = 0
while count < 5: {
    println("while循环: count = " + count.to_string())
    count += 1
}

// for循环
println("\nfor循环:")
for i in 0..5: {
    println("i = " + i.to_string())
}

// 结构体测试
println("\n=== 结构体测试 ===")
let person = Person {
    name: "张三"
    age: 25
    active: true
}
println("Person: name = " + person.name + ", age = " + person.age.to_string())

// 枚举和模式匹配测试
println("\n=== 枚举和模式匹配测试 ===")
let status = Status::Success("操作成功")

match status: {
    Status::Loading => println("加载中..."),
    Status::Success(data) => println("成功: " + data),
    Status::Error(message) => println("错误: " + message),
    Status::Idle => println("空闲")
}

// 组生命周期管理测试
println("\n=== 组生命周期管理测试 ===")
group ResourceManager {
    var resource_id: int
    var allocated: bool = false
    
    init {
        self.resource_id = 1000
        self.allocated = true
        println("资源已分配: " + self.resource_id.to_string())
    }
    
    fn allocate_resource() -> int {
        self.resource_id += 1
        println("分配新资源: " + self.resource_id.to_string())
        self.resource_id
    }
    
    cleanup {
        println("资源已释放: " + self.resource_id.to_string())
        self.allocated = false
    }
}

let rm = ResourceManager
let new_id = rm.allocate_resource()
println("新资源ID: " + new_id.to_string())

// 数组测试
println("\n=== 数组测试 ===")
let numbers = [1, 2, 3, 4, 5]
for num in numbers: {
    println("数组元素: " + num.to_string())
}

// Lambda表达式测试
println("\n=== Lambda表达式测试 ===")
let square = (x: int) -> int = x * x
println("5的平方: " + square(5).to_string())

println("\n=== 测试完成 ===")